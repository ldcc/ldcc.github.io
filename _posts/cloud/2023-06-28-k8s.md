---
layout: post
title: Kubernetes 入门概念介绍
categories: cloud
tags: k8s docker
date: 2023-05-12
hide: true
---

怎么感觉现在做个啥都要用

{% include brline %}

## Kubernetes 对象

### spec 与 status

Kubernetes 对象是一种 __意向表达（Record of Intent）__，一旦创建了某个对象，本质上是在告知 Kubernetes 系统集群工作负载状态看起来应是什么样子的， 这就是所谓的 __期望状态（Desired State）__。

对象的期望状态正是由 spec 决定的，而 Status 描述了对象当前状态，在任何时刻，Kubernetes 控制平面都一直在积极地管理着对象的实际状态，以使之达成期望状态。

基于以上原理，在创建 Kubernetes 对象时，必须提供对象的 spec。

### 必须字段

Kubernetes 对象所对应的 .yaml 文件中，需要配置的字段都有如下：

- apiVersion - 创建该对象所使用的 Kubernetes API 的版本。
- kind - 对象的类别。
- metadata - 帮助唯一标识对象的一些数据，包括一个 name 字符串、UID 和可选的 namespace
- spec - 你所期望的该对象的状态。

对每个 Kubernetes 对象而言，spec 的格式都是不同的，包含了特定于该对象的嵌套字段。 Kubernetes 官方提供了 [Kubernetes API][k8s-api] 参考可以找到所有 Kubernetes 对象的规约格式。

### 字段验证 

出于 Kubernetes 对象 spec 的属性之多，配置之复杂，API 服务器提供了服务器端字段验证， 可以检测对象中未被识别或重复的字段。

kubectl 工具使用 --validate 标志来设置字段验证级别。它接受值 ignore、warn 和 strict，同时还接受值 true（等同于 strict）和 false（等同于 ignore）。kubectl 的默认验证设置为 --validate=true。

- Strict 严格的字段验证，验证失败时会报错
- Warn 执行字段验证，但错误会以警告形式提供而不是拒绝请求
- Ignore 不执行服务器端字段验证

### 对象管理

Kubernetes 需要时刻管理着对象的状态使之能不断接近期望状态，管理的范式在官方介绍中又称为 `management techniques`，一共有 3 种：


| techniques     | 作用于   | 建议的环境 | 支持的 writers | 学习难度 |
| -------------- | -------- | ---------- | ---------- | -------- |
| 指令式命令     | 活跃对象 | 开发项目   | 1+         | 最低     |
| 指令式对象配置 | 单个文件 | 生产项目   | 1          | 中等     |
| 声明式对象配置 | 文件目录 | 生产项目   | 1+         | 最高     |

指令式命令遵循着命令式编程范式来设计，侧重于通过告诉计算机如何执行操作来更改程序的状态，它直接通过命令及其选项完成对象的管理操作，前面用到的 run、expose、delete 和 get 等命令都属于此类，执行时用户需要告诉系统要做什么，例如，使用 run 命令创建一个有着 3 个pod对象副本的Deployment对象，或者通过 delete 命令删除一个名为 myapp 的 Service 对象。





Kubernetes 的 API Server 能遵循多种编程范式去控制

应该只使用一种 techniques 来管理 Kubernetes 对象。混合 techniques 作用在同一对象上将导致未定义行为。








[k8s-api]: https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/workload-resources/